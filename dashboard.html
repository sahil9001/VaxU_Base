<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html class="has-navbar-fixed-top">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css"
    />
    <link rel="stylesheet" href="styles/styles.css" />
    <script src="https://use.fontawesome.com/36f44874b6.js"></script>
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
    <script>
        var exists = localStorage.length;
        if(!exists)
            {
                alert("You need to login first!");
                var host = "sahil9001.github.io/VaxU_Base/";
                window.location.href = "http://" + host;            
            }
    </script>
  </head>
  <body>

    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->
    <nav
      class="navbar is-fixed-top signal-navbar"
      role="navigation"
      aria-label="main navigation"
    >
      <div class="container">
        <div class="navbar-brand">
          <a href="">
            <img class="signal-logo" src="assets/logo/VaxU_Logo.png" />
          </a>
          <a
            role="button"
            class="navbar-burger"
            aria-label="menu"
            aria-expanded="false"
            data-target="navbarBasicExample"
          >
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
          <div class="navbar-start">
            <a class="navbar-item"> Home </a>
            <a class="navbar-item" href="#whyus"> Why VaxU? </a>
            <a class="navbar-item"> Home </a>
            <a class="navbar-item"> Get VaxU </a>
          </div>
          <div class="navbar-end">
            <div class="navbar-item">
                <p id="welcome">Welcome</p>&nbsp;
                <p id="user_name"></p>
            </div>
             <div class="navbar-item">
              <div class="buttons">
                <button class="button is-link" onclick="logout()">Log Out</button>
              </div>
             </div>
            </div>
        </div>
      </div>
    </nav>
    <section class="first-three">
        <div class="container">
          <div class="columns">
            <div class="column is-one-third">
                <div class="card">
                    <div class="card-image">
                        <figure class="image is-4by3">
                            <img src="https://bulma.io/images/placeholders/1280x960.png" alt="vaccine_image">
                        </figure>
                    </div>
                    <div class="card-content">
                        <div class="media-content">
                        <p class="title is-4">Number of Vaccines left:</p>
                        <h2 id="vaccinesLeft">14</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column is-one-third">
                <div class="card">
                    <div class="card-image">
                        <figure class="image is-4by3">
                            <img src="https://bulma.io/images/placeholders/1280x960.png" alt="vaccine_image">
                        </figure>
                    </div>
                    <div class="card-content">
                        <div class="media-content">
                        <p class="title is-4">Cost per Vaccine:</p>
                        <h2 id="priceOfVaccine">14</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column is-one-third">
                <div class="card">
                    <div class="card-image">
                        <figure class="image is-4by3">
                            <img src="https://bulma.io/images/placeholders/1280x960.png" alt="vaccine_image">
                        </figure>
                    </div>
                    <div class="card-content">
                        <div class="media-content">
                        <p class="title is-4">Status:</p>
                        <h2 id="availabitlityStatus">Available</h2>
                        </div>
                    </div>
                </div>
            </div>
          </div>
        </div>
      </section>
      <section class="section listAndImage">
          <div class="container">
              <div class="columns">
                  <div class="column is-two-fifths">
                      <div class="card">
                              <div class="card-content">
                                 <div class="media-content">
                                      <p class="title is-4">User List : </p>
                                      <ul>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                          <li>abc</li>
                                      </ul>
                                  </div>
                              </div>
                      </div>
                  </div>
                  <div class="column is-three-fifths">
                        <button type="button" class="button is-primary" id="button1" onclick="startWebcam()" style="margin-left: 50px;">Start the Webcam!</button>
                        <button class="button is-primary" id="button2" onclick="takeSnap()" style="margin-left: 100px;">Take picture!</button>
                        <button class="button is-primary" id="button3" onclick="stopWebcam()" style="margin-left: 100px">Stop the Webcam!</button>
                        <video id="webcam" autoplay playsinline  width="640" height="480" style="margin-left: 65px; margin-top: 50px; border: 1px solid black;"></video>
                        <canvas id="canvas" class="" style="margin-left: 65px; margin-top: 50px; border: 1px solid black;"></canvas>
                        <audio id="snapSound" src="assets/camera-shutter-click-01.wav" preload = "auto"></audio>
                  </div>
              </div>
              <div class="buttons is-centered">
              <button class="button is-success is-medium" onclick="submit()">Submit!</button>
              </div>
          </div>
      </section>
    <footer class="footer">
      <div class="container">
        <div class="columns">
          <div class="column is-two-fifths is-hidden-mobile">
            <span class="copyright"> Made by Team --- </span>
          </div>
          <div class="column has-text-right">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3718.5489569646056!2d81.60284041448581!3d21.249727185574887!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3a28dde213f66723%3A0x21543965c50c43c7!2sNational%20Institute%20of%20Technology%2C%20Raipur!5e0!3m2!1sen!2sin!4v1612431218471!5m2!1sen!2sin"
              width="500"
              height="300"
              frameborder="0"
              style="border: 0"
              allowfullscreen=""
              aria-hidden="false"
              tabindex="0"
            ></iframe>
          </div>
        </div>
      </div>
    </footer>
    <script src="styles/jquery-3.5.1.js"></script>
    <script>
        var host = "sahil9001.github.io/VaxU_Base/";
            console.log(typeof(document.cookie));
            var name = getCookie('username');
            console.log(name);
            document.getElementById("user_name").innerHTML = name;
            function getCookie(cname) {
              var name = cname + "=";
              var decodedCookie = decodeURIComponent(document.cookie);
              var ca = decodedCookie.split(';');
              for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                  c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                  return c.substring(name.length, c.length);
                }
              }
              return "";
            }
            const webcamElement = document.getElementById('webcam');
            const canvasElement = document.getElementById('canvas');
            const snapSoundElement = document.getElementById('snapSound');
            const webcam = new Webcam(webcamElement, 'user', canvasElement, snapSoundElement);
            function startWebcam() {
                webcam.start()
               .then(result =>{
                  console.log("webcam started");
               })
               .catch(err => {
                   console.log(err);
               });
            }
            function takeSnap(){
                let picture = webcam.snap();
                document.querySelector('#download-photo').href = picture;
            }

            function flipCamera(){
                $('#cameraFlip').click(function() {
                webcam.flip();
                webcam.start();
            });
            }
            function submit(){
                var canvas = document.getElementById('canvas');
                
            }

            function stopWebcam(){
                webcam.stop();
            }
            $(document).ready(function () {
                function getvalues(){
                var urlToHit = "http://20.198.3.123/api/core/";
                var request = new XMLHttpRequest();
                var token = localStorage.getItem(name);
                request.open("GET", urlToHit, true);
                request.setRequestHeader("Content-type", "application/json");
                request.setRequestHeader("Authorization", token);
                request.onreadystatechange = function() {
                    if(request.readyState == 4 && request.status == 200){
                        var response = request.responseText;
                        var obj = JSON.parse(response);
                        console.log(obj.vaccines_available);
                        console.log(obj.price);
                        console.log(obj.is_available);
                        document.getElementById('vaccinesLeft').innerHTML = obj.vaccines_available;
                        document.getElementById('priceOfVaccine').innerHTML = obj.price;
                        document.getElementById('availablityStatus').innerHTML = obj.is_available;
                }
            }
                request.send();
            }
            getvalues();
            });
            /*function getvalues(){
                var urlToHit = "http://20.198.3.123/api/core/";
                var request = new XMLHttpRequest();
                var token = localStorage(name.stringify());
                request.open("GET", urlToHit, true);
                request.setRequestHeader("Content-type", "application/json");
                request.setRequestHeader("Authorization", token);
                request.onreadystatechange = function() {
                    if(request.readyState == 4 && request.status == 200){
                        var response = request.responseText;
                        var obj = JSON.parse(response);
                        console.log(obj.vaccines_available);
                        console.log(obj.price);
                        console.log(obj.is_available);
                        document.getElementById('vaccinesLeft').innerHTML = obj.vaccines_available;
                        document.getElementById('priceOfVaccine').innerHTML = obj.price;
                        document.getElementById('availablityStatus').innerHTML = obj.is_available;
                }
            }
                request.send();
            }
            getvalues();*/
            function logout(){
                console.log(name);
                localStorage.removeItem(name);
                window.location = "http://" + host + "/";
            }                       
        /*const webcamElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('canvas');
        const snapSoundElement = document.getElementById('snapSound');
        const webcam = new Webcam(webcamElement, 'user', canvasElement, snapSoundElement);
        function startWebcam() {
            webcam.start()
           .then(result =>{
              console.log("webcam started");
           })
           .catch(err => {
               console.log(err);
           });
        }
        function takeSnap(){
            let picture = webcam.snap();
            document.querySelector('#download-photo').href = picture;
        }

        function flipCamera(){
            $('#cameraFlip').click(function() {
            webcam.flip();
            webcam.start();
        });
        }
        function submit(){
            var canvas = document.getElementById('canvas');
            
        }
        
        function stopWebcam(){
            webcam.stop();
        }
        var urlToHit = "http://20.198.3.123/api/core/";
        var request = new XMLHttpRequest();
        var token = localStorage('token');
        request.open("GET", urlToHit, true);
        request.setRequestHeader("Content-type", "application/json");
        request.setRequestHeader("Authorization", token);
        request.onreadystatechange = function() {
            if(request.readyState == 4 && request.status == 200){
                var response = request.responseText;
                var obj = JSON.parse(response);
                document.getElementById('vaccinesLeft').innerHTML = obj.vaccines_available;
                document.getElementById('priceOfVaccine').innerHTML = obj.price;
                document.getElementById('availablityStatus').innerHTML = obj.is_available;
            }
        }
        request.send();
        function logout(){
            localStorage.removeItem('token');
            window.location = "http://" + host + "/index.html";
        }*/
    </script>
<!--    <script language="JavaScript" type="text/javascript" src="styles/app.js"></script>-->
  </body>
</html>
